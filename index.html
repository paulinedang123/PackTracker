<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PackTrail ‚Äî Backpack Weight Planner</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  /* Palette */
  --teal:    #073b3a;
  --emerald: #0b6e4f;
  --pale-sky:#bfcde0;
  --white:   #fefcfd;
  --red:     #ff101f;

  /* Surfaces ‚Äî dark teal family */
  --bg:      #042120;
  --surface: #063230;
  --surface2:#083d3b;
  --card:    rgba(191,205,224,0.06);
  --card-hi: rgba(191,205,224,0.11);

  /* Borders */
  --border:       rgba(191,205,224,0.14);
  --border-hi:    rgba(191,205,224,0.28);
  --border-focus: rgba(34,201,132,0.55);

  /* Interactive / accent */
  --green:  #22c984;
  --green2: #0b6e4f;
  --gdim:   rgba(34,201,132,0.15);

  /* Text */
  --text:   #fefcfd;
  --text2:  #bfcde0;
  --muted:  #6b90a0;
  --accent: #9ed8bf;

  /* Status */
  --yellow: #f5c842;
  --ydim:   rgba(245,200,66,0.12);
  --orange: #f07830;
  --sky:    #bfcde0;

  --r:9px;--rsm:6px;--rf:999px;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;background:var(--bg);color:var(--text);font-family:'Inter',sans-serif;overflow:hidden;-webkit-font-smoothing:antialiased}
input,select,button{font-family:'Inter',sans-serif}
::-webkit-scrollbar{width:3px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:rgba(191,205,224,0.15);border-radius:3px}

header{height:50px;display:flex;align-items:center;gap:8px;padding:0 20px;background:rgba(4,33,32,0.94);border-bottom:1px solid var(--border);backdrop-filter:blur(14px);z-index:20;position:relative}
.ldot{width:7px;height:7px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green)}
.lname{font-size:14px;font-weight:700;letter-spacing:-0.025em;color:var(--accent)}
.lsep{color:var(--muted);margin:0 2px;font-size:13px}
.lsub{font-size:12px;font-weight:400;color:var(--muted)}

.app{display:grid;grid-template-columns:300px 1fr 316px;height:calc(100vh - 50px)}

/* LEFT */
.lp{background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden}
.ph{height:42px;display:flex;align-items:center;justify-content:space-between;padding:0 14px;border-bottom:1px solid var(--border);flex-shrink:0}
.phl{font-size:10px;font-weight:700;letter-spacing:0.07em;text-transform:uppercase;color:var(--text2)}
.bsm{height:24px;padding:0 9px;border-radius:var(--rsm);font-size:11px;font-weight:600;cursor:pointer;transition:all 0.15s;display:flex;align-items:center;gap:4px;border:1px solid}
.bg{background:var(--gdim);border-color:rgba(34,201,132,0.3);color:var(--green)}.bg:hover{background:rgba(34,201,132,0.22);border-color:rgba(34,201,132,0.55)}

.tb{padding:10px 12px;border-bottom:1px solid var(--border);flex-shrink:0}
.tg{display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-bottom:8px}
.fw{display:flex;flex-direction:column;gap:4px}
.fw label{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:0.08em;color:var(--muted)}
.fw select,.fw input[type=number]{padding:6px 8px;background:var(--card);border:1px solid var(--border);border-radius:var(--rsm);color:var(--text);font-size:12px;font-weight:500;outline:none;width:100%;appearance:none;transition:border-color 0.15s;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='9' height='5'%3E%3Cpath d='M0 0l4.5 5L9 0' stroke='%23658065' stroke-width='1.4' fill='none'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 8px center}
.fw input[type=number]{background-image:none;padding-right:8px}
.fw select:focus,.fw input:focus{border-color:var(--border-focus)}.fw select option{background:#063230}
.teh{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
.teh span{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:0.08em;color:var(--muted)}
.bte{font-size:10px;font-weight:600;color:var(--text2);background:none;border:none;cursor:pointer;padding:2px 7px;border-radius:4px;transition:all 0.13s}.bte:hover{color:var(--accent);background:var(--card)}
.teb{display:none}.teb.open{display:block}
.eg{display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px}
.tc{display:flex;align-items:center;justify-content:center;gap:5px;font-size:11px;font-weight:500;color:var(--yellow);background:var(--ydim);border:1px solid rgba(240,208,112,0.18);border-radius:var(--rsm);padding:5px 10px;margin-top:8px}

.ss{padding:8px 12px 5px;display:flex;flex-direction:column;gap:6px;flex-shrink:0}
.sw{position:relative}
.si{position:absolute;left:9px;top:50%;transform:translateY(-50%);color:var(--muted);font-size:12px;pointer-events:none}
.sin{width:100%;padding:6px 9px 6px 27px;background:var(--card);border:1px solid var(--border);border-radius:var(--rsm);color:var(--text);font-size:12px;outline:none;transition:border-color 0.15s}
.sin:focus{border-color:var(--border-focus)}.sin::placeholder{color:var(--muted)}
.scr{display:flex;align-items:center;gap:6px}
.ssel{padding:4px 22px 4px 8px;background:var(--card);border:1px solid var(--border);border-radius:var(--rsm);color:var(--text2);font-size:11px;font-weight:500;outline:none;appearance:none;cursor:pointer;flex-shrink:0;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='5'%3E%3Cpath d='M0 0l4 5 4-5' stroke='%23658065' stroke-width='1.3' fill='none'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 6px center;transition:border-color 0.15s}.ssel:focus{border-color:var(--border-focus)}.ssel option{background:#063230}
.cs{display:flex;gap:4px;overflow-x:auto;flex:1}.cs::-webkit-scrollbar{height:0}
.ct{flex-shrink:0;padding:3px 9px;border-radius:var(--rf);font-size:10px;font-weight:600;background:transparent;border:1px solid var(--border);color:var(--muted);cursor:pointer;transition:all 0.14s;white-space:nowrap}
.ct:hover{border-color:var(--border-hi);color:var(--text2)}.ct.active{background:var(--gdim);border-color:rgba(34,201,132,0.38);color:var(--green)}

.gsc{flex:1;overflow-y:auto;padding:4px 8px 10px}
.gr{display:flex;align-items:center;gap:8px;padding:7px 8px;border-radius:var(--r);border:1px solid transparent;transition:all 0.13s;margin-bottom:2px}
.gr:hover{background:var(--card-hi);border-color:var(--border)}.gr.ip{background:rgba(34,201,132,0.09);border-color:rgba(34,201,132,0.25)}
.ge{font-size:15px;width:20px;text-align:center;flex-shrink:0}
.gi{flex:1;min-width:0}
.gn{font-size:12px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--text)}
.gc{font-size:10px;color:var(--muted)}
.gar{display:flex;align-items:center;gap:3px;flex-shrink:0}
.gw{font-size:11px;color:var(--yellow);font-weight:600;min-width:28px;text-align:right;margin-right:2px}
.ic{width:20px;height:20px;border-radius:5px;border:1px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:10px;cursor:pointer;transition:all 0.13s;background:transparent;color:var(--muted);flex-shrink:0}
.ie:hover{border-color:rgba(136,200,224,0.45);color:var(--sky);background:rgba(136,200,224,0.09)}
.id:hover{border-color:rgba(232,96,96,0.4);color:var(--red);background:rgba(232,96,96,0.08)}
.ia{border-color:rgba(34,201,132,0.38);color:var(--green);font-size:13px}.ia:hover{background:var(--green);color:var(--bg);border-color:var(--green)}
.ia.ip{border-color:rgba(232,96,96,0.35);color:var(--red)}.ia.ip:hover{background:var(--red);color:#fff;border-color:var(--red)}

/* CENTER */
.cp{background:linear-gradient(160deg,#042120 0%,#063230 50%,#083d3b 100%);display:flex;flex-direction:column;overflow:hidden;position:relative}
.cp::before{content:'';position:absolute;inset:0;opacity:0.03;pointer-events:none;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E")}
.csc{flex:1;overflow-y:auto;padding:18px 56px 16px;display:flex;flex-direction:column;gap:14px;position:relative;z-index:1}
.csc::-webkit-scrollbar{width:3px}

.ws{text-align:center;flex-shrink:0}
.tbig{font-size:54px;font-weight:700;letter-spacing:-0.04em;line-height:1;color:var(--text);transition:color 0.4s}
.tbig.warn{color:var(--yellow)}.tbig.danger{color:var(--red);animation:pr 0.9s infinite}
@keyframes pr{0%,100%{opacity:1}50%{opacity:0.5}}
.tunit{font-size:16px;font-weight:500;color:var(--muted);margin-left:4px;vertical-align:super}
.tsub{font-size:12px;font-weight:500;color:var(--muted);margin-top:3px}
.sbadge{display:inline-block;margin-top:8px;font-size:10px;font-weight:700;letter-spacing:0.08em;text-transform:uppercase;padding:4px 12px;border-radius:var(--rf);border:1px solid;transition:all 0.4s}
.sbok{color:var(--green);border-color:rgba(34,201,132,0.38);background:rgba(34,201,132,0.1)}
.sbwarn{color:var(--yellow);border-color:rgba(240,208,112,0.35);background:rgba(240,208,112,0.09)}
.sbheavy{color:var(--orange);border-color:rgba(232,136,58,0.35);background:rgba(232,136,58,0.09)}
.sbcrush{color:var(--red);border-color:rgba(232,96,96,0.4);background:rgba(232,96,96,0.1);animation:pr 1s infinite}

.csect{display:flex;gap:16px;align-items:flex-start;flex-shrink:0}
.dw{position:relative;width:124px;height:124px;flex-shrink:0}
.dw svg{width:100%;height:100%}
.dc{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;pointer-events:none}
.dlbs{font-size:19px;font-weight:700;letter-spacing:-0.03em;color:var(--text);transition:color 0.4s}
.dlbs.warn{color:var(--yellow)}.dlbs.danger{color:var(--red)}
.dunit{font-size:9px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:0.06em;margin-top:1px}

.cbars{flex:1;display:flex;flex-direction:column;gap:7px;min-width:0}
.cbr{}
.cbrt{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:3px}
.cbrn{font-size:11px;font-weight:500;color:var(--text2)}.cbrw{font-size:11px;font-weight:600;color:var(--yellow)}
.cbtrack{height:5px;background:rgba(255,255,255,0.07);border-radius:3px;overflow:hidden}
.cbfill{height:100%;border-radius:3px;transition:width 0.5s cubic-bezier(0.34,1.2,0.64,1)}
.cbempty{font-size:11px;color:var(--muted);padding:6px 0}

.cdiv{height:1px;background:var(--border);flex-shrink:0}

.wls{flex:1;display:flex;flex-direction:column;gap:10px;min-height:180px}
.wlh{display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.wlt{font-size:11px;font-weight:700;letter-spacing:0.06em;text-transform:uppercase;color:var(--text2);display:flex;align-items:center;gap:6px}
.wldot{width:5px;height:5px;border-radius:50%;background:var(--green);opacity:0.8}
.schi{font-size:10px;font-weight:600;color:var(--muted);background:var(--card);border:1px solid var(--border);border-radius:var(--rf);padding:3px 10px}

.wcards{display:flex;flex-direction:column;gap:7px;overflow-y:auto;flex:1}
.wcards::-webkit-scrollbar{width:2px}
.wcard{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:11px 13px;transition:border-color 0.16s}
.wcard:hover{border-color:var(--border-hi)}
.wct{display:flex;align-items:flex-start;gap:10px;margin-bottom:5px}
.wce{font-size:22px;flex-shrink:0;line-height:1;margin-top:1px}
.wcn{font-size:13px;font-weight:600;color:var(--text);letter-spacing:-0.01em}
.wcc{font-size:10px;font-weight:500;color:var(--muted);margin-top:1px;font-style:italic}
.wtag{margin-left:auto;flex-shrink:0;font-size:9px;font-weight:700;letter-spacing:0.06em;text-transform:uppercase;padding:2px 8px;border-radius:var(--rf);border:1px solid}
.tc-c{color:var(--green);border-color:rgba(125,218,136,0.3);background:rgba(125,218,136,0.08)}
.tc-r{color:var(--yellow);border-color:rgba(240,208,112,0.3);background:rgba(240,208,112,0.08)}
.tc-m{color:var(--sky);border-color:rgba(136,200,224,0.3);background:rgba(136,200,224,0.08)}
.wdesc{font-size:11px;color:var(--text2);line-height:1.6}
.wwhere{font-size:10px;font-weight:500;color:var(--muted);margin-top:5px}

/* RIGHT */
.rp{background:var(--surface);border-left:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden}
.sgrid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;padding:10px 11px;border-bottom:1px solid var(--border);flex-shrink:0}
.sbox{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:9px 6px;text-align:center}
.sv{font-size:19px;font-weight:700;color:var(--green);letter-spacing:-0.03em;line-height:1}
.sl{font-size:9px;font-weight:700;color:var(--muted);margin-top:3px;text-transform:uppercase;letter-spacing:0.07em}
.seclbl{padding:9px 12px 3px;font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:0.09em;color:var(--muted);flex-shrink:0}
.trws{padding:0 8px;flex-shrink:0}
.trw{display:flex;justify-content:space-between;align-items:center;font-size:11px;color:var(--text2);padding:4px 7px;background:rgba(240,208,112,0.05);border:1px solid rgba(240,208,112,0.1);border-radius:6px;margin-bottom:3px}
.trw span:last-child{color:var(--yellow);font-weight:600}
.plist{flex:1;overflow-y:auto;padding:5px 8px 5px}
.pempty{text-align:center;padding:28px 12px;color:var(--muted);font-size:12px;line-height:1.8}
.pitem{display:flex;align-items:center;gap:7px;padding:7px 8px;background:rgba(34,201,132,0.06);border:1px solid rgba(34,201,132,0.16);border-radius:var(--r);margin-bottom:3px;animation:sli 0.18s ease}
@keyframes sli{from{opacity:0;transform:translateX(8px)}to{opacity:1;transform:translateX(0)}}
.piem{font-size:14px;flex-shrink:0}
.pinf{flex:1;min-width:0}
.pin{font-size:11px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--text)}
.pic{font-size:9px;color:var(--muted)}
.piw{font-size:11px;font-weight:600;color:var(--yellow);flex-shrink:0}
.prm{width:18px;height:18px;border-radius:4px;border:1px solid rgba(232,96,96,0.25);color:var(--red);background:transparent;font-size:10px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.12s;flex-shrink:0}
.prm:hover{background:var(--red);color:#fff;border-color:var(--red)}
.bclr{margin:6px 8px 10px;padding:8px;background:transparent;border:1px solid rgba(232,96,96,0.18);border-radius:var(--r);color:rgba(232,96,96,0.5);font-size:11px;font-weight:500;cursor:pointer;transition:all 0.17s;flex-shrink:0}
.bclr:hover{background:rgba(232,96,96,0.08);border-color:rgba(232,96,96,0.4);color:var(--red)}

/* MODAL */
.mov{position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:100;display:none;align-items:center;justify-content:center;backdrop-filter:blur(8px)}
.mov.open{display:flex}
.modal{background:#063230;border:1px solid rgba(255,255,255,0.1);border-radius:13px;padding:22px;width:368px;max-width:93vw;box-shadow:0 20px 60px rgba(0,0,0,0.65);animation:mo 0.2s cubic-bezier(0.34,1.3,0.64,1)}
@keyframes mo{from{opacity:0;transform:scale(0.93) translateY(8px)}to{opacity:1;transform:scale(1) translateY(0)}}
.mtitle{font-size:16px;font-weight:700;letter-spacing:-0.02em;margin-bottom:16px;color:var(--accent)}
.mf{margin-bottom:11px}
.mf label{display:block;font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:0.09em;color:var(--muted);margin-bottom:5px}
.mf input,.mf select{width:100%;padding:8px 10px;background:var(--card);border:1px solid var(--border);border-radius:var(--rsm);color:var(--text);font-size:13px;outline:none;transition:border-color 0.14s}
.mf input:focus,.mf select:focus{border-color:var(--border-focus)}.mf select option{background:#063230}
.m2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.epick{display:flex;flex-wrap:wrap;gap:4px;max-height:88px;overflow-y:auto}
.eo{font-size:18px;cursor:pointer;padding:3px;border-radius:5px;border:1px solid transparent;transition:all 0.11s;line-height:1}
.eo:hover{background:var(--card);border-color:var(--border)}.eo.sel{background:var(--gdim);border-color:rgba(34,201,132,0.45)}
.mbtns{display:flex;gap:8px;margin-top:16px;justify-content:flex-end}
.bcancel{padding:7px 16px;background:transparent;border:1px solid var(--border);border-radius:var(--rsm);color:var(--muted);cursor:pointer;font-size:12px;font-weight:500;transition:all 0.15s}.bcancel:hover{border-color:var(--border-hi);color:var(--text)}
.bsave{padding:7px 16px;background:var(--green2);border:none;border-radius:var(--rsm);color:#fff;font-weight:600;cursor:pointer;font-size:12px;transition:background 0.15s}.bsave:hover{background:var(--green);color:var(--bg)}
</style>
</head>
<body>

<header>
  <span class="ldot"></span>
  <span class="lname">PackTrail</span>
  <span class="lsep">¬∑</span>
  <span class="lsub">Southern California Trail Planner</span>
</header>

<div class="app">

<!-- LEFT -->
<div class="lp">
  <div class="ph"><span class="phl">Gear Catalog</span><button class="bsm bg" onclick="openModal()">Ôºã Add Item</button></div>

  <div class="tb">
    <div class="tg">
      <div class="fw"><label>Duration</label>
        <select id="trip-days" onchange="updateTrip()">
          <option value="1">Day Hike</option><option value="2">Overnight</option>
          <option value="3" selected>3 Days</option><option value="5">5 Days</option>
          <option value="7">7 Days</option><option value="10">10 Days</option><option value="14">2 Weeks</option>
        </select>
      </div>
      <div class="fw"><label>Season</label>
        <select id="trip-season" onchange="updateTrip()">
          <option value="summer">‚òÄÔ∏è Summer</option><option value="spring" selected>üå± Spring</option>
          <option value="fall">üçÇ Fall</option><option value="winter">‚ùÑÔ∏è Winter</option>
        </select>
      </div>
    </div>
    <div class="teh"><span>Trip Essentials (auto-added)</span><button class="bte" onclick="toggleEss(this)">Edit ‚ñ∏</button></div>
    <div class="teb" id="teb">
      <div class="eg">
        <div class="fw"><label>Food lb/day</label><input type="number" id="e-food" value="1.5" min="0" step="0.1" onchange="updateTrip()"></div>
        <div class="fw"><label>Water (lb)</label><input type="number" id="e-water" value="2.2" min="0" step="0.1" onchange="updateTrip()"></div>
        <div class="fw"><label>Misc (lb)</label><input type="number" id="e-misc" value="0.5" min="0" step="0.1" onchange="updateTrip()"></div>
      </div>
      <div style="font-size:9px;color:var(--muted);margin-top:6px;line-height:1.5">Misc = toiletries, consumables. Season clothing added automatically.</div>
    </div>
    <div class="tc" id="tc">calculating‚Ä¶</div>
  </div>

  <div class="ss">
    <div class="sw">
      <span class="si">‚åï</span>
      <input class="sin" id="sin" type="text" placeholder="Search gear‚Ä¶" oninput="renderGear()">
    </div>
    <div class="scr">
      <select class="ssel" id="sort" onchange="renderGear()">
        <option value="def">Default</option>
        <option value="az">A ‚Üí Z</option>
        <option value="za">Z ‚Üí A</option>
        <option value="heavy">Heaviest</option>
        <option value="light">Lightest</option>
      </select>
      <div class="cs" id="cs"></div>
    </div>
  </div>

  <div class="gsc" id="gsc"></div>
</div>

<!-- CENTER -->
<div class="cp">
  <div class="csc">
    <div class="ws">
      <div><span class="tbig" id="tbig">0.0</span><span class="tunit">lb</span></div>
      <div class="tsub" id="tsub">0 items ¬∑ 0.0 kg</div>
      <div><span class="sbadge sbok" id="sbadge" style="display:none"></span></div>
    </div>

    <div class="csect">
      <div class="dw">
        <svg viewBox="0 0 124 124" id="dsv">
          <circle cx="62" cy="62" r="48" fill="none" stroke="rgba(255,255,255,0.06)" stroke-width="19"/>
          <g id="darcs"></g>
        </svg>
        <div class="dc"><div class="dlbs" id="dlbs">0.0</div><div class="dunit">lbs</div></div>
      </div>
      <div class="cbars" id="cbars"><div class="cbempty">Add items to see breakdown</div></div>
    </div>

    <div class="cdiv"></div>

    <div class="wls">
      <div class="wlh">
        <div class="wlt"><span class="wldot"></span>Wildlife You Might Spot</div>
        <div class="schi" id="schi">üå± Spring</div>
      </div>
      <div class="wcards" id="wcards"><div style="padding:20px;text-align:center;color:var(--muted);font-size:12px">Select a season to load wildlife guide</div></div>
    </div>
  </div>
</div>

<!-- RIGHT -->
<div class="rp">
  <div class="ph"><span class="phl">Your Pack</span></div>
  <div class="sgrid">
    <div class="sbox"><div class="sv" id="si">0</div><div class="sl">Items</div></div>
    <div class="sbox"><div class="sv" id="slbs">0.0</div><div class="sl">lbs</div></div>
    <div class="sbox"><div class="sv" id="skg">0.0</div><div class="sl">kg</div></div>
  </div>
  <div class="seclbl">Auto-added for trip</div>
  <div class="trws" id="trws"></div>
  <div class="seclbl">Packed items</div>
  <div class="plist" id="plist"><div class="pempty">‚Üê Add gear from the catalog</div></div>
  <button class="bclr" onclick="clearPack()">‚ö† Clear all packed items</button>
</div>

</div>

<!-- MODAL -->
<div class="mov" id="mov">
  <div class="modal">
    <div class="mtitle" id="mtitle">Add Custom Item</div>
    <div class="mf"><label>Item Name</label><input type="text" id="mn" placeholder="e.g. Satellite phone"></div>
    <div class="m2">
      <div class="mf"><label>Weight (lbs)</label><input type="number" id="mw" placeholder="0.5" step="0.05" min="0"></div>
      <div class="mf"><label>Category</label>
        <select id="mc"><option>Big 3</option><option>Clothing</option><option>Kitchen</option><option>Water</option><option>Navigation</option><option>Tools</option><option>Hygiene</option><option>Extras</option></select>
      </div>
    </div>
    <div class="mf"><label>Icon</label><div class="epick" id="ep"></div></div>
    <div class="mbtns"><button class="bcancel" onclick="closeModal()">Cancel</button><button class="bsave" onclick="saveItem()">Save</button></div>
  </div>
</div>

<script>
const EMOJIS=['üéí','‚õ∫','üõèÔ∏è','üî•','üíß','üó∫Ô∏è','üß•','üëï','üëñ','üß¶','üß§','üß£','üî¶','üîß','ü©∫','ü™¢','üêª','üé£','üì∑','üìì','üîã','‚òÄÔ∏è','üå¥','ü™ë','üßº','ü™•','ü¶ü','üåû','ü•ò','‚õΩ','üö∞','üì°','üß≠','üíä','ü™£','üßª','ü™û','üí®','üìØ','üõñ','üå¨Ô∏è','üì¶','ü•Ñ','‚òï','ü¶µ','üèïÔ∏è','üß¢','üèñÔ∏è','üîë','‚ö°'];
const CC={'Big 3':'#ff6b6b','Clothing':'#adb5bd','Kitchen':'#ffd43b','Water':'#38d9a9','Navigation':'#da77f2','Tools':'#ff922b','Hygiene':'#a9e34b','Extras':'#f783ac','Trip Essentials':'#74c0fc'};
const SE={
  summer:{icon:'‚òÄÔ∏è',label:'Summer',fm:1.0,wb:2.6,cl:0},
  spring:{icon:'üå±',label:'Spring',fm:1.0,wb:2.2,cl:0.5},
  fall:  {icon:'üçÇ',label:'Fall',  fm:1.05,wb:2.0,cl:1.0},
  winter:{icon:'‚ùÑÔ∏è',label:'Winter',fm:1.2, wb:1.8,cl:2.5},
};
const WL={
  spring:[
    {e:'üê¶',n:'Allen\'s Hummingbird',sci:'Selasphorus sasin',r:'c',d:'Brilliant orange-red males aggressively defend flower patches along coastal bluffs and in chaparral canyons. One of SoCal\'s most charismatic breeders ‚Äî listen for their high, buzzy chip calls.',w:'Coastal sage scrub, canyon gardens'},
    {e:'ü¶ã',n:'Western Tiger Swallowtail',sci:'Papilio rutulus',r:'c',d:'Large yellow-and-black butterfly appearing in March along stream corridors. Males mud-puddle at wet ground near trails. A reliable sign that spring has truly arrived.',w:'Riparian corridors, streamside trails'},
    {e:'üê¶',n:'Western Tanager',sci:'Piranga ludoviciana',r:'m',d:'Stunning red-headed male passes through in May fueling up before heading to mountain breeding grounds. Look in oaks and mixed forest ‚Äî one of the most striking migrants in the region.',w:'Oak woodland, mixed conifer slopes'},
    {e:'üê¶',n:'California Gnatcatcher',sci:'Polioptila californica',r:'r',d:'Federally threatened and nearly endemic to coastal sage scrub. Tiny blue-gray bird with a mewing cat-like call. A genuine rarity ‚Äî finding one is a highlight for any birder.',w:'Coastal sage scrub only'},
    {e:'ü¶é',n:'Coast Horned Lizard',sci:'Phrynosoma blainvillii',r:'r',d:'Emerging from winter dormancy in March‚ÄìApril. Masters of sandy-soil camouflage. Feeds on harvester ants. State species of special concern ‚Äî look but never handle.',w:'Sandy chaparral, open scrub flats'},
    {e:'üê¶',n:'Yellow Warbler',sci:'Setophaga petechia',r:'m',d:'Bright lemon-yellow with chestnut breast streaks, singing a rapid bubbly "sweet sweet sweet." One of the most abundant spring migrants through riparian corridors in April and May.',w:'Willows, stream corridors, riparian edges'},
  ],
  summer:[
    {e:'ü¶Ö',n:'White-tailed Kite',sci:'Elanus leucurus',r:'c',d:'Ghost-white raptor that hovers motionless over open grassland while hunting rodents. Nests in eucalyptus near trail heads. Most active at dawn and dusk when air is cooler.',w:'Open grasslands, valley edges, ridgelines'},
    {e:'üê¶',n:'Nuttall\'s Woodpecker',sci:'Dryobates nuttallii',r:'c',d:'California endemic found almost exclusively in oak woodland. Black-and-white barred back is distinctive. Listen for a sharp rattling whinny echoing off oak trunks. Year-round resident.',w:'Oak woodland, live oak canyons'},
    {e:'üê¶',n:'Ash-throated Flycatcher',sci:'Myiarchus cinerascens',r:'c',d:'Rusty-tailed, pale-breasted flycatcher nesting in tree cavities throughout open chaparral and woodland. Call is a sharp "ka-brick." Lively and vocal through summer mornings.',w:'Open chaparral, oak woodland clearings'},
    {e:'ü¶é',n:'Western Fence Lizard',sci:'Sceloporus occidentalis',r:'c',d:'The iconic "blue belly" of California trails. Males do conspicuous pushups to display iridescent blue patches. Remarkably, ticks feeding on these lizards lose their Lyme disease bacteria.',w:'Rocky outcrops, sunny trail edges, everywhere'},
    {e:'ü¶Å',n:'Mountain Lion',sci:'Puma concolor',r:'r',d:'SoCal has one of the world\'s highest densities. Primarily nocturnal but sometimes seen at dawn or dusk. If you encounter one: stand tall, make yourself large, back away slowly. Never run.',w:'All habitats ‚Äî most active at dawn and dusk'},
    {e:'üê¶',n:'Lawrence\'s Goldfinch',sci:'Spinus lawrencei',r:'r',d:'California endemic that wanders nomadically in summer following seeding plants. Gray-headed males flash yellow wing patches. One of the most sought-after birds for visiting birders.',w:'Dry chaparral, seeding annual plants'},
  ],
  fall:[
    {e:'ü¶Ö',n:'Golden Eagle',sci:'Aquila chrysaetos',r:'c',d:'Large and powerful, soaring mountain ridges on flat wings with a golden nape glow. Hunts rabbits and squirrels across open chaparral. Far more common in SoCal fall than most people realize.',w:'Mountain ridges, open chaparral, thermals'},
    {e:'üê¶',n:'Townsend\'s Warbler',sci:'Setophaga townsendi',r:'c',d:'Striking black, yellow and olive warbler arriving in October ‚Äî one of the most abundant fall migrants through SoCal mountains. Often forms large mixed flocks with other species in oaks and pines.',w:'Oak-pine forest, mixed slopes'},
    {e:'ü¶â',n:'Northern Saw-whet Owl',sci:'Aegolius acadicus',r:'r',d:'Tiny owl migrating through mountain passes in October‚ÄìNovember. Nocturnal ‚Äî listen after dusk for its repetitive monotone tooting near dense conifers. Surprisingly common but almost never seen.',w:'Mountain conifer forest, dense pine groves'},
    {e:'üê¶',n:'Hermit Thrush',sci:'Catharus guttatus',r:'c',d:'The only Catharus thrush that winters in California. Spotted breast with rusty tail. Has arguably the most beautiful song of any North American bird ‚Äî occasionally heard at dawn even in fall.',w:'Dense riparian shrubs, canyon understory'},
    {e:'ü¶ä',n:'Gray Fox',sci:'Urocyon cinereoargenteus',r:'c',d:'The tree-climbing fox. Salt-and-pepper coat with rusty flanks and a black-tipped tail. Young foxes are foraging widely in fall. Most likely seen trotting across the trail at dusk.',w:'Chaparral, oak woodland edges, canyon trails'},
    {e:'üêù',n:'Monarch Butterfly',sci:'Danaus plexippus',r:'c',d:'Fall migration southward brings large aggregations to coastal eucalyptus groves. Millions pass through SoCal in October‚ÄìNovember heading to overwintering sites in Pismo and Pacific Grove.',w:'Coastal eucalyptus groves, open ridges'},
  ],
  winter:[
    {e:'üê¶',n:'Yellow-rumped Warbler',sci:'Setophaga coronata',r:'c',d:'By far the most abundant winter bird in SoCal. Large flocks flash white and yellow rump patches in flight through chaparral and juniper. Uniquely able to digest the wax in juniper berries.',w:'Chaparral, juniper, coastal scrub ‚Äî everywhere'},
    {e:'ü¶Ö',n:'Ferruginous Hawk',sci:'Buteo regalis',r:'r',d:'Largest North American buteo, wintering in open valleys and mountain foothills. Distinctive rusty-red back creates a clear V pattern from below. A memorable find on winter ridge hikes.',w:'Open grasslands, valley floors, foothill edges'},
    {e:'ü¶å',n:'Mule Deer',sci:'Odocoileus hemionus',r:'c',d:'Highly visible in winter as deer move to lower elevations. Does and juveniles travel in groups along brushy trail margins. Bucks have shed antlers by January and grow velvet through spring.',w:'Chaparral transition zones, trail margins at dawn'},
    {e:'üê¶',n:'Mountain Bluebird',sci:'Sialia currucoides',r:'r',d:'When cold weather drives them down from higher elevations, males are an electric sky-blue that seems impossible in the landscape. Look for them hovering over open scrub on cold clear days.',w:'Open mountain meadows, sparse high chaparral'},
    {e:'ü¶Ü',n:'Surf Scoter',sci:'Melanitta perspicillata',r:'c',d:'Large black sea duck with a spectacular colorful bill ‚Äî males look like they\'re wearing a cartoon mask. Large rafts visible offshore from coastal ridges. Common winter visitor from November through March.',w:'Coastal ocean, visible offshore from high ridges'},
    {e:'üê¶',n:'Cedar Waxwing',sci:'Bombycilla cedrorum',r:'m',d:'Elegant crested birds with silky plumage and bright red wingtip spots. Arrive in irregular winter flocks to strip berries from toyon, mistletoe, and ornamental trees. Their high thin whistle is distinctive.',w:'Fruiting trees and shrubs, riparian woodland'},
  ],
};

let gearDB=[
  {id:1,n:'Backpack (60L)',e:'üéí',c:'Big 3',lbs:2.8},{id:2,n:'Backpack (45L)',e:'üéí',c:'Big 3',lbs:2.2},
  {id:3,n:'Ultralight Backpack',e:'üéí',c:'Big 3',lbs:1.1},{id:4,n:'Tent (2-person)',e:'‚õ∫',c:'Big 3',lbs:4.5},
  {id:5,n:'Tent (1-person)',e:'‚õ∫',c:'Big 3',lbs:2.2},{id:6,n:'Bivy Sack',e:'üõñ',c:'Big 3',lbs:0.7},
  {id:7,n:'Tarp Shelter',e:'üèïÔ∏è',c:'Big 3',lbs:1.0},{id:8,n:'Sleeping Bag (20¬∞F)',e:'üõèÔ∏è',c:'Big 3',lbs:2.8},
  {id:9,n:'Sleeping Bag (0¬∞F)',e:'üõèÔ∏è',c:'Big 3',lbs:3.5},{id:10,n:'Down Quilt',e:'üå¨Ô∏è',c:'Big 3',lbs:1.4},
  {id:11,n:'Sleeping Pad (foam)',e:'üì¶',c:'Big 3',lbs:0.9},{id:12,n:'Sleeping Pad (inflat.)',e:'üõèÔ∏è',c:'Big 3',lbs:1.2},
  {id:13,n:'Rain Jacket',e:'üß•',c:'Clothing',lbs:0.9},{id:14,n:'Fleece Layer',e:'üëï',c:'Clothing',lbs:0.7},
  {id:15,n:'Down Jacket',e:'üß•',c:'Clothing',lbs:1.0},{id:16,n:'Hiking Pants (2 pr)',e:'üëñ',c:'Clothing',lbs:1.0},
  {id:17,n:'Thermal Underwear',e:'üß£',c:'Clothing',lbs:0.5},{id:18,n:'Merino T-shirts (2)',e:'üëï',c:'Clothing',lbs:0.5},
  {id:19,n:'Hiking Socks (3 pr)',e:'üß¶',c:'Clothing',lbs:0.4},{id:20,n:'Wool Hat',e:'üß¢',c:'Clothing',lbs:0.2},
  {id:21,n:'Gloves',e:'üß§',c:'Clothing',lbs:0.2},{id:22,n:'Gaiters',e:'ü¶µ',c:'Clothing',lbs:0.5},
  {id:23,n:'Camp Stove',e:'üî•',c:'Kitchen',lbs:0.5},{id:24,n:'Fuel Canister',e:'‚õΩ',c:'Kitchen',lbs:0.8},
  {id:25,n:'Titanium Pot',e:'ü•ò',c:'Kitchen',lbs:0.4},{id:26,n:'Spork',e:'ü•Ñ',c:'Kitchen',lbs:0.05},
  {id:27,n:'Bear Canister',e:'üêª',c:'Kitchen',lbs:2.2},{id:28,n:'Camp Mug',e:'‚òï',c:'Kitchen',lbs:0.3},
  {id:29,n:'Water Bottles (2L)',e:'üíß',c:'Water',lbs:4.4},{id:30,n:'Hydration Bladder',e:'üíß',c:'Water',lbs:4.0},
  {id:31,n:'Water Filter',e:'üö∞',c:'Water',lbs:0.6},{id:32,n:'Iodine Tablets',e:'üíä',c:'Water',lbs:0.05},
  {id:33,n:'GPS Device',e:'üì°',c:'Navigation',lbs:0.5},{id:34,n:'Paper Maps',e:'üó∫Ô∏è',c:'Navigation',lbs:0.2},
  {id:35,n:'Compass',e:'üß≠',c:'Navigation',lbs:0.1},{id:36,n:'Satellite Communicator',e:'üì°',c:'Navigation',lbs:0.3},
  {id:37,n:'Trekking Poles',e:'ü™¢',c:'Tools',lbs:1.2},{id:38,n:'Headlamp',e:'üî¶',c:'Tools',lbs:0.3},
  {id:39,n:'Multi-tool',e:'üîß',c:'Tools',lbs:0.5},{id:40,n:'First Aid Kit',e:'ü©∫',c:'Tools',lbs:0.7},
  {id:41,n:'Fire Starter',e:'üî•',c:'Tools',lbs:0.1},{id:42,n:'Emergency Blanket',e:'ü™û',c:'Tools',lbs:0.1},
  {id:43,n:'Bear Spray',e:'üí®',c:'Tools',lbs:0.9},{id:44,n:'Trowel',e:'ü™£',c:'Hygiene',lbs:0.15},
  {id:45,n:'TP & Waste Bags',e:'üßª',c:'Hygiene',lbs:0.2},{id:46,n:'Toothbrush & Paste',e:'ü™•',c:'Hygiene',lbs:0.15},
  {id:47,n:'Biodegradable Soap',e:'üßº',c:'Hygiene',lbs:0.2},{id:48,n:'Sunscreen',e:'üåû',c:'Hygiene',lbs:0.3},
  {id:49,n:'Insect Repellent',e:'ü¶ü',c:'Hygiene',lbs:0.2},{id:50,n:'Microfiber Towel',e:'üèñÔ∏è',c:'Hygiene',lbs:0.4},
  {id:51,n:'Camera',e:'üì∑',c:'Extras',lbs:1.0},{id:52,n:'Journal & Pen',e:'üìì',c:'Extras',lbs:0.3},
  {id:53,n:'Power Bank',e:'üîã',c:'Extras',lbs:0.7},{id:54,n:'Camp Chair',e:'ü™ë',c:'Extras',lbs:1.8},
  {id:55,n:'Hammock',e:'üå¥',c:'Extras',lbs:1.2},{id:56,n:'Solar Charger',e:'‚òÄÔ∏è',c:'Extras',lbs:0.5},
  {id:57,n:'Fishing Gear',e:'üé£',c:'Extras',lbs:1.5},
];

let pack=[],activeCat='All',editId=null,selEmoji='üéí',nextId=200;

function tripW(){
  const days=parseInt(document.getElementById('trip-days').value);
  const s=SE[document.getElementById('trip-season').value];
  const fpd=parseFloat(document.getElementById('e-food').value)||1.5;
  const wb=parseFloat(document.getElementById('e-water').value)||2.2;
  const misc=parseFloat(document.getElementById('e-misc').value)||0.5;
  return {
    food:+(days*fpd*s.fm).toFixed(2),
    water:+(wb*(s.wb/2.2)).toFixed(2),
    cloth:+s.cl.toFixed(2),
    misc:+misc.toFixed(2)
  };
}
function tripTot(){const t=tripW();return t.food+t.water+t.cloth+t.misc;}

function toggleEss(btn){
  const b=document.getElementById('teb');
  const o=b.classList.toggle('open');
  btn.textContent=o?'Done ‚ñæ':'Edit ‚ñ∏';
}

function updateTrip(){
  const s=SE[document.getElementById('trip-season').value];
  const tot=tripTot();
  document.getElementById('tc').textContent=`+${tot.toFixed(1)} lb auto-added (food, water, clothing, misc)`;
  document.getElementById('schi').textContent=`${s.icon} ${s.label}`;
  renderWildlife(document.getElementById('trip-season').value);
  render();
}

function renderWildlife(season){
  const el=document.getElementById('wcards');
  const list=WL[season]||[];
  el.innerHTML=list.map(w=>{
    const tc=w.r==='c'?'tc-c':w.r==='m'?'tc-m':'tc-r';
    const tl=w.r==='c'?'Common':w.r==='m'?'Migrant':'Uncommon';
    return `<div class="wcard">
      <div class="wct">
        <span class="wce">${w.e}</span>
        <div><div class="wcn">${w.n}</div><div class="wcc">${w.sci}</div></div>
        <span class="wtag ${tc}">${tl}</span>
      </div>
      <div class="wdesc">${w.d}</div>
      <div class="wwhere">üìç ${w.w}</div>
    </div>`;
  }).join('');
}

function render(){
  renderCats();renderGear();renderCenter();renderPack();
}

function renderCats(){
  const cats=['All',...new Set(gearDB.map(g=>g.c))];
  document.getElementById('cs').innerHTML=cats.map(c=>
    `<div class="ct${c===activeCat?' active':''}" onclick="setC('${c}')">${c}</div>`
  ).join('');
}
function setC(c){activeCat=c;renderCats();renderGear();}

function renderGear(){
  const q=document.getElementById('sin').value.toLowerCase();
  const s=document.getElementById('sort').value;
  let list=gearDB.filter(g=>(activeCat==='All'||g.c===activeCat)&&g.n.toLowerCase().includes(q));
  if(s==='az') list=[...list].sort((a,b)=>a.n.localeCompare(b.n));
  else if(s==='za') list=[...list].sort((a,b)=>b.n.localeCompare(a.n));
  else if(s==='heavy') list=[...list].sort((a,b)=>b.lbs-a.lbs);
  else if(s==='light') list=[...list].sort((a,b)=>a.lbs-b.lbs);
  const el=document.getElementById('gsc');
  if(!list.length){el.innerHTML='<div style="padding:20px;text-align:center;color:var(--muted);font-size:12px">No items found</div>';return;}
  el.innerHTML=list.map(g=>{
    const ip=pack.includes(g.id);
    const wd=g.lbs<0.1?(g.lbs*16).toFixed(0)+'oz':g.lbs+'lb';
    return `<div class="gr${ip?' ip':''}">
      <span class="ge">${g.e}</span>
      <div class="gi"><div class="gn">${g.n}</div><div class="gc">${g.c}</div></div>
      <div class="gar">
        <span class="gw">${wd}</span>
        <button class="ic ie" onclick="openModal(${g.id})" title="Edit">‚úé</button>
        <button class="ic id" onclick="delItem(${g.id})" title="Delete">‚úï</button>
        <button class="ic ia${ip?' ip':''}" onclick="togPack(${g.id})">${ip?'‚àí':'+'}</button>
      </div>
    </div>`;
  }).join('');
}

function renderCenter(){
  const items=pack.map(id=>gearDB.find(g=>g.id===id)).filter(Boolean);
  const tTot=tripTot();
  const gLbs=items.reduce((s,i)=>s+i.lbs,0);
  const total=+(gLbs+tTot).toFixed(2);

  document.getElementById('tbig').textContent=total.toFixed(1);
  document.getElementById('tbig').className='tbig'+(total>30?' danger':total>20?' warn':'');
  document.getElementById('tsub').textContent=`${items.length} item${items.length!==1?'s':''} ¬∑ ${(total*0.4536).toFixed(1)} kg`;
  document.getElementById('dlbs').textContent=total.toFixed(1);
  document.getElementById('dlbs').className='dlbs'+(total>30?' danger':total>20?' warn':'');

  const badge=document.getElementById('sbadge');
  if(total===0){badge.style.display='none';badge.textContent='';}
  else if(total<15){badge.style.display='none';badge.textContent='';}
  else if(total<25){badge.style.display='none';badge.textContent='';}
  else if(total<35){badge.style.display='inline-block';badge.className='sbadge sbwarn';badge.textContent='‚ö† Getting Heavy';}
  else{badge.style.display='inline-block';badge.className='sbadge sbcrush';badge.textContent='üíÄ Way Too Much!';}

  const cats={};
  items.forEach(i=>{cats[i.c]=(cats[i.c]||0)+i.lbs;});
  if(tTot>0) cats['Trip Essentials']=tTot;

  const R=48,C=2*Math.PI*R;
  const aEl=document.getElementById('darcs');
  const bEl=document.getElementById('cbars');

  if(total===0){
    aEl.innerHTML='<circle cx="62" cy="62" r="48" fill="none" stroke="rgba(255,255,255,0.06)" stroke-width="19"/>';
    bEl.innerHTML='<div class="cbempty">Add items to see breakdown</div>';
    return;
  }

  let off=0,aH='',bH='';
  Object.entries(cats).sort((a,b)=>b[1]-a[1]).forEach(([cat,w])=>{
    const pct=w/total;
    const dash=pct*C;
    const color=CC[cat]||'#888';
    const rot=-90+(off/C)*360;
    aH+=`<circle cx="62" cy="62" r="${R}" fill="none" stroke="${color}" stroke-width="19"
      stroke-dasharray="${dash.toFixed(2)} ${(C-dash).toFixed(2)}"
      transform="rotate(${rot.toFixed(2)} 62 62)"
      style="transition:stroke-dasharray 0.5s ease"/>`;
    bH+=`<div class="cbr">
      <div class="cbrt"><span class="cbrn">${cat}</span><span class="cbrw">${w.toFixed(1)} lb</span></div>
      <div class="cbtrack"><div class="cbfill" style="width:${Math.max(pct*100,2).toFixed(1)}%;background:${color}"></div></div>
    </div>`;
    off+=dash;
  });
  aEl.innerHTML=aH;bEl.innerHTML=bH;
}

function renderPack(){
  const items=pack.map(id=>gearDB.find(g=>g.id===id)).filter(Boolean);
  const tw=tripW();const tTot=tripTot();
  const gLbs=items.reduce((s,i)=>s+i.lbs,0);
  const total=gLbs+tTot;
  document.getElementById('si').textContent=items.length;
  document.getElementById('slbs').textContent=total.toFixed(1);
  document.getElementById('skg').textContent=(total*0.4536).toFixed(1);

  const days=document.getElementById('trip-days').value;
  let tr='';
  if(tw.food>0) tr+=`<div class="trw"><span>üçú Food (${days}d)</span><span>${tw.food.toFixed(1)} lb</span></div>`;
  if(tw.water>0) tr+=`<div class="trw"><span>üíß Water</span><span>${tw.water.toFixed(1)} lb</span></div>`;
  if(tw.cloth>0) tr+=`<div class="trw"><span>üß• Season clothing</span><span>${tw.cloth.toFixed(1)} lb</span></div>`;
  if(tw.misc>0) tr+=`<div class="trw"><span>üß¥ Misc</span><span>${tw.misc.toFixed(1)} lb</span></div>`;
  document.getElementById('trws').innerHTML=tr;

  const pl=document.getElementById('plist');
  if(!items.length){pl.innerHTML='<div class="pempty">‚Üê Add gear from the catalog</div>';return;}
  pl.innerHTML=items.map(i=>{
    const w=i.lbs<0.1?(i.lbs*16).toFixed(0)+'oz':i.lbs+'lb';
    return `<div class="pitem"><span class="piem">${i.e}</span><div class="pinf"><div class="pin">${i.n}</div><div class="pic">${i.c}</div></div><span class="piw">${w}</span><button class="prm" onclick="togPack(${i.id})">‚úï</button></div>`;
  }).join('');
}

function togPack(id){if(pack.includes(id))pack=pack.filter(x=>x!==id);else pack.push(id);render();}
function clearPack(){pack=[];render();}
function delItem(id){pack=pack.filter(x=>x!==id);gearDB=gearDB.filter(g=>g.id!==id);render();}

function openModal(id){
  editId=id||null;
  if(id){
    const it=gearDB.find(g=>g.id===id);
    document.getElementById('mtitle').textContent='Edit Item';
    document.getElementById('mn').value=it.n;
    document.getElementById('mw').value=it.lbs;
    document.getElementById('mc').value=it.c;
    selEmoji=it.e;
  } else {
    document.getElementById('mtitle').textContent='Add Custom Item';
    document.getElementById('mn').value='';document.getElementById('mw').value='';
    document.getElementById('mc').value='Extras';selEmoji='üéí';
  }
  document.getElementById('ep').innerHTML=EMOJIS.map(e=>`<span class="eo${e===selEmoji?' sel':''}" onclick="selE('${e}')">${e}</span>`).join('');
  document.getElementById('mov').classList.add('open');
}
function closeModal(){document.getElementById('mov').classList.remove('open');editId=null;}
function selE(e){selEmoji=e;document.querySelectorAll('.eo').forEach(el=>el.classList.toggle('sel',el.textContent===e));}
function saveItem(){
  const name=document.getElementById('mn').value.trim();
  const lbs=parseFloat(document.getElementById('mw').value);
  const cat=document.getElementById('mc').value;
  if(!name||isNaN(lbs)||lbs<0){alert('Enter a valid name and weight.');return;}
  if(editId){const it=gearDB.find(g=>g.id===editId);it.n=name;it.lbs=lbs;it.c=cat;it.e=selEmoji;}
  else gearDB.push({id:nextId++,n:name,e:selEmoji,c:cat,lbs});
  closeModal();render();
}
document.getElementById('mov').addEventListener('click',e=>{if(e.target.id==='mov')closeModal();});

updateTrip();render();
</script>
</body>
</html>
